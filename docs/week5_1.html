<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Decision Trees – PSYC559: Applied Machine Learning in Psychology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-121a38a6e2c75e451ef209d5f681333d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week3_1.html">Regression</a></li><li class="breadcrumb-item"><a href="./week5_1.html">Decision Trees</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PSYC559: Applied Machine Learning in Psychology</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table of Contents</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic R Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_1b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading in Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week1_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Describing Data Numerically</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week1_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Describing Data Visually</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Important Terms and Distinctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Classes in ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Splitting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bias and Variance</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Feature Engineering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numeric Feature Engineering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5f.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Feature Engineering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2_5g.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflow</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week4_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regularized Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week5_1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Decision Trees</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview-of-decision-trees" id="toc-overview-of-decision-trees" class="nav-link active" data-scroll-target="#overview-of-decision-trees">Overview of Decision Trees</a></li>
  <li><a href="#parts-of-a-decision-tree" id="toc-parts-of-a-decision-tree" class="nav-link" data-scroll-target="#parts-of-a-decision-tree">Parts of a Decision Tree</a></li>
  <li><a href="#overview-how-do-decision-trees-work" id="toc-overview-how-do-decision-trees-work" class="nav-link" data-scroll-target="#overview-how-do-decision-trees-work">Overview: How do Decision Trees Work?</a></li>
  <li><a href="#how-purity-guides-splitting" id="toc-how-purity-guides-splitting" class="nav-link" data-scroll-target="#how-purity-guides-splitting">How Purity Guides Splitting</a></li>
  <li><a href="#step-1-impurity-at-the-parent-node" id="toc-step-1-impurity-at-the-parent-node" class="nav-link" data-scroll-target="#step-1-impurity-at-the-parent-node">Step 1: Impurity at the Parent Node</a></li>
  <li><a href="#step-2-impurity-at-candidate-splits" id="toc-step-2-impurity-at-candidate-splits" class="nav-link" data-scroll-target="#step-2-impurity-at-candidate-splits">Step 2: Impurity at Candidate Splits</a></li>
  <li><a href="#step-3-information-gain-or-impurity-reduction" id="toc-step-3-information-gain-or-impurity-reduction" class="nav-link" data-scroll-target="#step-3-information-gain-or-impurity-reduction">Step 3: Information Gain or Impurity Reduction</a></li>
  <li><a href="#step-4-choosing-the-best-feature" id="toc-step-4-choosing-the-best-feature" class="nav-link" data-scroll-target="#step-4-choosing-the-best-feature">Step 4: Choosing the Best Feature</a></li>
  <li><a href="#how-low-can-you-go" id="toc-how-low-can-you-go" class="nav-link" data-scroll-target="#how-low-can-you-go">How Low Can You Go?</a></li>
  <li><a href="#limitations-of-standard-decision-trees" id="toc-limitations-of-standard-decision-trees" class="nav-link" data-scroll-target="#limitations-of-standard-decision-trees">Limitations of Standard Decision Trees</a></li>
  <li><a href="#implementation-in-r" id="toc-implementation-in-r" class="nav-link" data-scroll-target="#implementation-in-r">Implementation in R</a></li>
  <li><a href="#decision-trees-personality-example" id="toc-decision-trees-personality-example" class="nav-link" data-scroll-target="#decision-trees-personality-example">Decision Trees: Personality Example</a></li>
  <li><a href="#decision-trees-titanic-example" id="toc-decision-trees-titanic-example" class="nav-link" data-scroll-target="#decision-trees-titanic-example">Decision Trees: Titanic Example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week3_1.html">Regression</a></li><li class="breadcrumb-item"><a href="./week5_1.html">Decision Trees</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Decision Trees</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview-of-decision-trees" class="level2" style="color: yellow">
<h2 class="anchored" data-anchor-id="overview-of-decision-trees">Overview of Decision Trees</h2>
</section>
<p>A decision tree is a predictive model that uses a tree-like structure to make decisions.</p>
<p>It splits data into smaller and smaller groups based on feature values, ultimately leading to a prediction at the “leaves” (the end points of the tree).</p>
<ul>
<li><p><strong>Classification trees:</strong> predict a category (e.g., spam vs.&nbsp;not spam).</p></li>
<li><p><strong>Regression trees</strong> predict a continuous outcome (e.g., house price).</p></li>
</ul>
<p>The name comes from the fact that the model looks like a flowchart: you start at the root (the top of the tree), follow branches based on yes/no or threshold-based questions about the features, and end up at a leaf with a prediction.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/what-is-a-decision-tree.webp" class="img-fluid figure-img" width="800"></p>
<figcaption>https://www.displayr.com/what-is-a-decision-tree/</figcaption>
</figure>
</div>
<section id="parts-of-a-decision-tree" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="parts-of-a-decision-tree">Parts of a Decision Tree</h3>
</section>
<ul>
<li><strong>Root Node</strong>: The top of the tree where the first split occurs. It contains all the data.</li>
<li><strong>Internal Nodes</strong>: Points where the data is split based on a feature. Each internal node represents a decision based on a feature value.</li>
<li><strong>Branches</strong>: The lines connecting nodes, representing the outcome of a decision.</li>
<li><strong>Leaf Nodes</strong>: The end points of the tree where a prediction is made.</li>
<li><strong>Splits</strong>: The conditions used to divide the data at each internal node.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tree_parts.png" class="img-fluid figure-img" width="800"></p>
<figcaption>https://bradleyboehmke.github.io/HOML/images/decision-tree-terminology.png</figcaption>
</figure>
</div>
<section id="overview-how-do-decision-trees-work" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="overview-how-do-decision-trees-work">Overview: How do Decision Trees Work?</h3>
</section>
<p>The tree is built by repeatedly asking:</p>
<blockquote class="blockquote">
<p>Which feature and split best separates the data?</p>
</blockquote>
<p>For <strong>classification tasks</strong>, we want splits that make the groups as “pure” as possible (mostly one class).</p>
<p>For <strong>regression tasks</strong>, we want splits that minimize the variability within each group, often using mean squared error (MSE).</p>
<p><strong>At each step, the algorithm chooses the best feature and split point, divides the data, and repeats until</strong>:</p>
<ul>
<li>The nodes are pure enough,</li>
<li>The maximum depth is reached, or</li>
<li>There are too few samples to keep splitting.</li>
</ul>
<section id="what-exactly-is-purity" class="level4" style="color: lightyellow">
<h4 class="anchored" data-anchor-id="what-exactly-is-purity">What Exactly is Purity?</h4>
</section>
<p>In the context of a decision tree, a node is pure if it contains only examples from a single class.</p>
<p>For example, suppose you’re predicting whether students pass or fail a project based on whether they attend class.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Student Attended Outcome
1       A      Yes    Pass
2       B      Yes    Pass
3       C      Yes    Fail
4       D       No    Fail
5       E       No    Fail
6       F       No    Pass</code></pre>
</div>
</div>
<p><strong>Step 1</strong>: The Roote Node</p>
<p>At the root node, we have all 6 students: 3 “pass” and 3 “fail” (50% pure).</p>
<p>If a node has 20 students and all of them are “pass”, that node is 100% pure.</p>
<p>Since the node has 3 “pass” and 3 “fail,” it’s very impure.</p>
<p>A common measure of impurity is the Gini impurity, which quantifies how often a randomly chosen element would be incorrectly labeled if it was randomly labeled according to the distribution of labels in the subset.</p>
<p><span class="math display">\[
Gini = 1 - p(Pass)^2 - p(Fail)^2
\]</span><br>
or more generally,</p>
<p><span class="math display">\[  
Gini = 1 - \sum (p_i)^2
\]</span></p>
<p><strong>Step 2</strong>: Splitting on Attendance</p>
<p>Now let’s split our data based on attendance.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> Gini_Yes   Gini_No 
0.4444444 0.4444444 </code></pre>
</div>
</div>
<p>Now, after the split:</p>
<ul>
<li>The “Yes” group has 2 “Pass” and 1 “Fail” (Gini impurity = 0.444).</li>
<li>The “No” group has 2 “Fail” and 1 “Pass” (Gini impurity = 0.444).</li>
</ul>
<p>Both groups are still impure, but we have better separated the students based on attendance.</p>
<section id="alternative-measures-of-purity" class="level4" style="color: lightyellow">
<h4 class="anchored" data-anchor-id="alternative-measures-of-purity">Alternative Measures of Purity</h4>
</section>
<p>Other common measures of impurity include:</p>
<p><strong>Entropy</strong>:</p>
<p>Measures the uncertainty in a dataset. Lower entropy means higher purity.</p>
<p><span class="math display">\[
  Entropy = - \sum p_i \log_2(p_i)
  \]</span> <strong>Misclassification Error</strong>:</p>
<p>The fraction of samples that do not belong to the majority class in a node.</p>
<p><span class="math display">\[
  Misclassification\ Error = 1 - \max(p_i)
  \]</span><br>
Like the Gini coefficient, these measures help the algorithm decide the best splits to create purer nodes.</p>
<section id="how-purity-guides-splitting" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="how-purity-guides-splitting">How Purity Guides Splitting</h3>
</section>
<p>At each node, the algorithm evaluates all possible splits across all features and selects the one that results in the highest increase in purity (or the largest decrease in impurity).</p>
<p>At each step, a decision tree faces the question:</p>
<blockquote class="blockquote">
<p>Which feature should I split on, and at what threshold?</p>
</blockquote>
<p>To answer this, it evaluates all possible splits and picks the one that produces the biggest increase in purity of the child nodes compared to the parent node.</p>
<section id="step-1-impurity-at-the-parent-node" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="step-1-impurity-at-the-parent-node">Step 1: Impurity at the Parent Node</h3>
</section>
<ul>
<li>The parent node contains some mix of classes.</li>
<li>Its impurity (e.g., Gini or entropy) is calculated.</li>
</ul>
<section id="step-2-impurity-at-candidate-splits" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="step-2-impurity-at-candidate-splits">Step 2: Impurity at Candidate Splits</h3>
</section>
<p>For each candidate feature and possible split point:</p>
<ul>
<li>Divide the data into two (or more) child nodes.</li>
<li>Compute the impurity of each child node.</li>
<li>Take a weighted average impurity across the children:</li>
</ul>
<p><span class="math display">\[
G\_{\text{split}} = \sum_{j=1}^{m} \frac{N_j}{N} , G_j,
\]</span> where, - $ G_{}$ is the impurity after the split. - <span class="math inline">\(m\)</span> is the number of child nodes. - <span class="math inline">\(N_j\)</span> is the number of samples in child node <span class="math inline">\(j\)</span>. - <span class="math inline">\(N\)</span> is the total number of samples in the parent node. - <span class="math inline">\(G_j\)</span> is the impurity of child node <span class="math inline">\(j\)</span>.</p>
<p>Our goal is to minimize this quantity <span class="math inline">\(G_{\text{split}}\)</span>. The split that results in the lowest weighted impurity is chosen.</p>
<section id="step-3-information-gain-or-impurity-reduction" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="step-3-information-gain-or-impurity-reduction">Step 3: Information Gain or Impurity Reduction</h3>
</section>
<p>For every feature we can then measure the “goodness” of a split as the reduction in impurity</p>
<p><span class="math display">\[
\Delta G = G_{\text{parent}} - G_{\text{split}},
\]</span> where, - $ G&nbsp;is the reduction in impurity (information gain). - <span class="math inline">\(G_{\text{parent}}\)</span> is the impurity of the parent node. - <span class="math inline">\(G_{\text{split}}\)</span> is the weighted impurity after the split.</p>
<section id="step-4-choosing-the-best-feature" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="step-4-choosing-the-best-feature">Step 4: Choosing the Best Feature</h3>
</section>
<ul>
<li>The tree tries every possible feature (and, for numeric features, possible threshold values).</li>
<li>The feature/threshold pair that gives the largest impurity reduction is chosen for the split.</li>
<li>This process repeats recursively, growing the tree until stopping conditions are met:
<ul>
<li>max depth</li>
<li>minimum samples, or</li>
<li>node purity</li>
</ul></li>
</ul>
<section id="how-low-can-you-go" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="how-low-can-you-go">How Low Can You Go?</h3>
</section>
<p>Decision trees can grow very deep, creating many splits to perfectly classify the training data. However, this can lead to overfitting, where the model captures noise instead of the underlying pattern. To prevent this, we can set limits on the tree’s growth, such as:</p>
<ul>
<li><strong>Maximum Depth</strong>: Limit how deep the tree can go.</li>
<li><strong>Minimum Samples per Leaf</strong>: Require a minimum number of samples in each leaf node.</li>
<li><strong>Minimum Samples to Split</strong>: Require a minimum number of samples to consider a split.</li>
<li><strong>Pruning</strong>: Remove branches that do not provide significant predictive power.</li>
</ul>
<p><img src="images/depth.png" class="img-fluid" width="800" alt="http://www.btechsmartclass.com/data_structures/tree-terminology.html"> By controlling the tree’s complexity, we can improve its ability to generalize to new, unseen data. This balance between fitting the training data and maintaining generalization is crucial for building effective decision tree models.</p>
<section id="early-stopping-criteria" class="level4" style="color: lightyellow">
<h4 class="anchored" data-anchor-id="early-stopping-criteria">Early Stopping Criteria</h4>
</section>
<p>To prevent overfitting and ensure that the decision tree generalizes well to unseen data, we can implement early stopping criteria during the tree-building process. Common early stopping criteria include:</p>
<p><strong>Maximum Depth</strong></p>
<p>Limit the maximum depth of the tree. A shallower tree is less likely to overfit. For example, we may set a maximum depth of 5 or 10 levels. If we choose too shallow a tree, it may underfit the data, however, the variance will likely be lower. If we choose too deep a tree, it may overfit the data, but, the variance will likely be higher.</p>
<p><strong>Minimum Samples per Leaf</strong></p>
<p>We can also set a minimum number of samples that must be present in a leaf node. This prevents the tree from creating leaves that are too specific to the training data.</p>
<p>On one hand we might allow for a single observation in a leaf, which would likely lead to overfitting. On the other hand, we might require at least 10 or 20 samples in each leaf, which could help the model generalize better.</p>
<p><strong>Minimum Impurity Decrease</strong></p>
<p>We could also only allow a split if it results in a significant decrease in impurity. This ensures that splits are meaningful and contribute to the model’s predictive power.</p>
<section id="pruning" class="level4" style="color: lightyellow">
<h4 class="anchored" data-anchor-id="pruning">Pruning</h4>
</section>
<p>Another approach to controlling tree complexity is pruning, which involves removing branches that do not provide significant predictive power.</p>
<p>Pruning can be done in two main ways:</p>
<p><strong>Post-Pruning</strong></p>
<p>This involves growing the full tree and then removing branches that do not improve performance on a validation set. This can be done by evaluating the tree’s performance after removing certain branches and keeping the changes that lead to better generalization.</p>
<p><strong>Pre-Pruning</strong></p>
<p>We could also add a penalty for tree complexity to the loss function used to evaluate splits. This encourages the model to prefer simpler trees that still perform well. Smaller penalties will lead to larger trees, while larger penalties will lead to smaller trees.</p>
<p>As with regularization, we would evaluate multiple models across a spectrum of hyperparamaters (penalty parameters) and then use cross-validation to identify the optimal value that generalizes best to unseen data.</p>
<p>In the <code>rpart</code> package, which we will use later, the complexity parameter <code>cp</code> controls how large a decision tree can grow before it is pruned. It is the main regularization tool that balances tree complexity against generalizability.</p>
<p><strong>How <code>cp</code> Works</strong></p>
<ul>
<li>Each split in a tree must reduce the lack of fit by at least <code>cp × error</code>.<br>
</li>
<li>If the reduction is smaller, the split is pruned away.<br>
</li>
<li>Large <code>cp</code> → smaller tree (simpler, more bias, less variance).<br>
</li>
<li>Small <code>cp</code> → larger tree (complex, less bias, more variance).</li>
</ul>
<p>Mathematically, the cost-complexity criterion is:</p>
<p><span class="math display">\[
R_{alpha(T)} \;=\; R(T) + \alpha |T|,
\]</span> where, - <span class="math inline">\(R(T)\)</span>: is the predictor error<br>
- <span class="math inline">\(T\)</span>: number of terminal nodes.<br>
- <span class="math inline">\(\alpha\)</span>: penalty hyperparameter (analogous to <code>cp</code>)</p>
<section id="limitations-of-standard-decision-trees" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="limitations-of-standard-decision-trees">Limitations of Standard Decision Trees</h3>
</section>
<p>In their standard form, decision trees have several limitations:</p>
<p><strong>Overfitting and Lack of Generalization</strong><br>
- Trees can keep splitting until each leaf is pure, perfectly fitting the training data.<br>
- This often captures noise and leads to poor generalization.</p>
<p><strong>High Variance / Instability</strong><br>
- Small changes in training data can lead to very different tree structures.<br>
- This instability makes them unreliable when used alone.</p>
<p><strong>Bias Toward Features with Many Levels</strong><br>
- Features with many unique categories (e.g., IDs, zip codes) can dominate splits.<br>
- The tree may overvalue these even when they’re not meaningful.</p>
<p><strong>Greedy, Locally Optimal Splitting</strong><br>
- Trees choose the best split at each step, but this is only a local optimum.<br>
- They can miss better global solutions.</p>
<section id="implementation-in-r" class="level2" style="color: yellow">
<h2 class="anchored" data-anchor-id="implementation-in-r">Implementation in R</h2>
</section>
<p>In R we can use the <code>rpart</code> package to create decision trees. The <code>rpart</code> package implements the widely popular CART (Classification and Regression Trees) algorithm for building decision trees.</p>
<section id="decision-trees-personality-example" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="decision-trees-personality-example">Decision Trees: Personality Example</h3>
</section>
<p>We will use the following libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rattle)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(titanic)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try to predict the variable <code>OPN8</code> using a decision tree. Remember, OPN8 is a dichotomous variable indicating whether a respondent strongly agrees (1) or does not strongly agree (0) with the statement “I use difficult words.” We will use the same data preprocessing steps as before and predict our outcome using all the personality items included in our example data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data-final-shuffled.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dichotomous_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)[<span class="fu">sapply</span>(data, max) <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>character_vars   <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)[<span class="fu">sapply</span>(data, class) <span class="sc">==</span> <span class="st">"character"</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>cat_vars         <span class="ot">&lt;-</span> <span class="fu">c</span>(character_vars,dichotomous_vars)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data[cat_vars ]  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data[cat_vars ], as.factor)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="st">"OPN8"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[<span class="sc">!</span><span class="fu">is.na</span>(data[,target]),]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(data, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> target)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>data_train  <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>data_test   <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, we can recreate our recipe from the in-class activity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>formula_string <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target, <span class="st">"~ ."</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>blueprint <span class="ot">&lt;-</span> <span class="fu">recipe</span>(formula_string, <span class="at">data =</span> data_train) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_bag</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_factor_predictors</span>(), <span class="at">one_hot =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s fit a decision tree model using 10-fold cross-validation to tune the complexity parameter (cp). The cp parameter controls the size of the decision tree and helps prevent overfitting by penalizing more complex trees. Here, <code>tuneLength</code> specifies the number of different cp values to try during the tuning process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cv_model_1 <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  blueprint,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_train,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">10</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After training we can visualize the cross-validation results to see how the model’s performance varies with different values of the complexity parameter (<code>cp</code>). Here we see that the model achieves the best accuracy with a <code>cp</code> value of approximately 0.05.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cv_model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week5_1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also visualize the final decision tree using the <code>fancyRpartPlot</code> function from the <code>rattle</code> package. This function provides a clear and informative visualization of the decision tree structure, including the splits, nodes, and predicted classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fancyRpartPlot</span>(cv_model_1<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week5_1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s evaluate the model’s performance using cross-validation results and a confusion matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set      </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_model_1, data_train)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create confusion matrix</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">relevel</span>(pred_class, <span class="at">ref =</span> <span class="st">"1"</span>), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> <span class="fu">relevel</span>(data_train[,target], <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   1   0
         1 204  71
         0 105 319
                                        
               Accuracy : 0.7482        
                 95% CI : (0.7143, 0.78)
    No Information Rate : 0.5579        
    P-Value [Acc &gt; NIR] : &lt; 2e-16       
                                        
                  Kappa : 0.4837        
                                        
 Mcnemar's Test P-Value : 0.01287       
                                        
            Sensitivity : 0.6602        
            Specificity : 0.8179        
         Pos Pred Value : 0.7418        
         Neg Pred Value : 0.7524        
             Prevalence : 0.4421        
         Detection Rate : 0.2918        
   Detection Prevalence : 0.3934        
      Balanced Accuracy : 0.7391        
                                        
       'Positive' Class : 1             
                                        </code></pre>
</div>
</div>
<section id="decision-trees-titanic-example" class="level3" style="color: orange">
<h3 class="anchored" data-anchor-id="decision-trees-titanic-example">Decision Trees: Titanic Example</h3>
</section>
<p>Let’s read in the Titanic training data from the <code>titanic</code> package and take a look at the data.</p>
<p>This package comes with data that is pre-split into training and test sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic<span class="sc">::</span>titanic_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the features included in <code>titanic_train</code>:</p>
<ul>
<li><code>Survived</code>: Whether the passenger survived (1) or not (0).<br>
</li>
<li><code>Pclass</code>: Passenger class (1st, 2nd, 3rd).</li>
<li><code>Sex</code>: Sex of passenger.</li>
<li><code>Age</code>: Age of the passenger.</li>
<li><code>SibSp</code>: Number of siblings/spouses aboard.</li>
<li><code>Parch</code>: Number of parents/children aboard.</li>
<li><code>Fare</code>: Ticket fare.</li>
<li><code>Embarked</code>: Port of embarkation (C = Cherbourg, Q = Queenstown, S = Southampton).</li>
</ul>
<p>We can get basic desciptives using the <code>psych</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(titanic_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            vars   n   mean     sd median trimmed    mad  min    max  range
PassengerId    1 891 446.00 257.35 446.00  446.00 330.62 1.00 891.00 890.00
Survived       2 891   0.38   0.49   0.00    0.35   0.00 0.00   1.00   1.00
Pclass         3 891   2.31   0.84   3.00    2.39   0.00 1.00   3.00   2.00
Name*          4 891 446.00 257.35 446.00  446.00 330.62 1.00 891.00 890.00
Sex*           5 891   1.65   0.48   2.00    1.68   0.00 1.00   2.00   1.00
Age            6 714  29.70  14.53  28.00   29.27  13.34 0.42  80.00  79.58
SibSp          7 891   0.52   1.10   0.00    0.27   0.00 0.00   8.00   8.00
Parch          8 891   0.38   0.81   0.00    0.18   0.00 0.00   6.00   6.00
Ticket*        9 891 339.52 200.83 338.00  339.65 268.35 1.00 681.00 680.00
Fare          10 891  32.20  49.69  14.45   21.38  10.24 0.00 512.33 512.33
Cabin*        11 891  18.63  38.14   1.00    8.29   0.00 1.00 148.00 147.00
Embarked*     12 891   3.53   0.80   4.00    3.66   0.00 1.00   4.00   3.00
             skew kurtosis   se
PassengerId  0.00    -1.20 8.62
Survived     0.48    -1.77 0.02
Pclass      -0.63    -1.28 0.03
Name*        0.00    -1.20 8.62
Sex*        -0.62    -1.62 0.02
Age          0.39     0.16 0.54
SibSp        3.68    17.73 0.04
Parch        2.74     9.69 0.03
Ticket*      0.00    -1.28 6.73
Fare         4.77    33.12 1.66
Cabin*       2.09     3.07 1.28
Embarked*   -1.27    -0.16 0.03</code></pre>
</div>
</div>
<p>Now, let’s fit our regression tree model to the Titanic data. We will predict the <code>Survived</code> variable using all other features in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>PassengerId <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>Name <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>Ticket <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>Cabin <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>Survived <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic_train<span class="sc">$</span>Survived)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic_train<span class="sc">$</span>Sex)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>blueprint_titanic <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Survived <span class="sc">~</span>., <span class="at">data =</span> titanic_train) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_bag</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_factor_predictors</span>(), <span class="at">one_hot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>cv_model_titanic <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  blueprint_titanic,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> titanic_train,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">20</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cv_model_titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week5_1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also visualize the final decision tree using the <code>fancyRpartPlot</code> function from the <code>rattle</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fancyRpartPlot</span>(cv_model_titanic<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week5_1_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s evaluate the model’s performance using cross-validation results and a confusion matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set      </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_model_titanic, titanic_train)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create confusion matrix</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">relevel</span>(pred_class, <span class="at">ref =</span> <span class="st">"1"</span>), </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> <span class="fu">relevel</span>(titanic_train[,<span class="st">"Survived"</span>], <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   1   0
         1 271  48
         0  71 501
                                          
               Accuracy : 0.8664          
                 95% CI : (0.8423, 0.8881)
    No Information Rate : 0.6162          
    P-Value [Acc &gt; NIR] : &lt; 2e-16         
                                          
                  Kappa : 0.714           
                                          
 Mcnemar's Test P-Value : 0.04372         
                                          
            Sensitivity : 0.7924          
            Specificity : 0.9126          
         Pos Pred Value : 0.8495          
         Neg Pred Value : 0.8759          
             Prevalence : 0.3838          
         Detection Rate : 0.3042          
   Detection Prevalence : 0.3580          
      Balanced Accuracy : 0.8525          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>